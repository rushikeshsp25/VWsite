{% extends 'home/base.html' %} {% block title %}Attendance Form | VisionWare {% endblock %} {% block head %}
{% load static %} {% endblock %} {% block body %}
<div class="container shadow p-3 mb-5 bg-white rounded mx-auto">
    <form role="form" method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="form-group row">
            <label for="batch" class="col-sm-2 col-form-label">Batch</label>
            <div class="col-sm-10">
                <select class="form-control" id="batch-select">
                <option></option>
                    {% for batch in batches %}
                    <option name="{{batch.batch_name}}" value="{{batch.id}}">{{batch.batch_name}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-group row">
            <label for="date" class="col-sm-2 col-form-label">Lecture Take By</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="lecture_taken_by" name="lecture_taken_by" required>
            </div>
        </div>

        <div class="form-group row">
            <label for="date" class="col-sm-2 col-form-label">Lecture Topics</label>
            <div class="col-sm-10">
                <textarea type="text" class="form-control" id="lecture_topics" name="lecture_topics" required></textarea>
            </div>
        </div>

        <div class="form-group row">
            <label for="date" class="col-sm-2 col-form-label">Date</label>
            <div class="col-sm-10">
                <input type="date" class="form-control" id="date" name="date" required disabled>
            </div>
        </div>

        <div class="form-group row">
            <label for="start_time" class="col-sm-2 col-form-label">Start Time</label>
            <div class="col-sm-4">
                <input type="time" class="form-control col-sm-10" id="start_time" name="start_time" placeholder="Start Time">
            </div>
            <label for="end_time" class="col-sm-2 col-form-label">End Time</label>
            <div class="col-sm-4">
                <input type="time" class="form-control " id="end_time" name="end_time" placeholder="End Time">
            </div>
        </div>

        <div class="form-group row">
            <label for="date" class="col-sm-2 col-form-label">Any special Remarks</label>
            <div class="col-sm-10">
                <textarea type="text" class="form-control" id="lecture_taken_by" name="lecture_taken_by" required></textarea>
            </div>
        </div>

        {% for student in students %}
        <p>{{student.first_name }} {{student.last_name}}</p>        
        {% endfor %}

        <div class="form-controls">
            <button type="submit" id="take_attendance" class="btn">Take Attendance</button>
        </div>
    </form>
</div>






{% endblock %}
{% block script%}
<script>

    var field = document.getElementById("date")
    var date = new Date();

    // Set the date
    field.value = date.getFullYear().toString() + '-' + (date.getMonth() + 1).toString().padStart(2, 0) +
        '-' + date.getDate().toString().padStart(2, 0);

</script>

<script>
 $("#batch-select").change(function () {
       batch_id=$(this).val();

       $.ajax({
        type: "POST",
        url: '{%  url 'home:attendance_form' %}',
        data: {
          'batch_id': batch_id
        },
        success: alert("hiii")
    
      });



    });

    function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
var csrftoken = getCookie('csrftoken');

function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
})


</script>


{% endblock %}